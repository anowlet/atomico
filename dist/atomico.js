"use strict";function remove(e,t){e.removeChild(t)}function append(e,t){e.appendChild(t)}function replace(e,t,r){e.replaceChild(t,r)}function create(e,t){return t?document.createElementNS("http://www.w3.org/2000/svg",e):e?document.createElement(e):document.createTextNode("")}function h(e,t,...r){return new VDom(e,t,concat(r))}Object.defineProperty(exports,"__esModule",{value:!0});class VDom{constructor(e,t,r){this.tag=e,this.props=t||{},this.children=r||[]}clone(e=this.tag,t=this.props,r=this.children){return new VDom(e,Object.assign({},t),r)}}function isVDom(e){return e instanceof VDom}function concat(e,t=[]){for(let r=0;r<e.length;r++){let n=e[r];Array.isArray(n)?concat(n,t):t.push(n)}return t}let PREVIOUS="__PREVIOUS__",LISTENERS="__LISTENERS__";function createRender(e){let t=e.tagName.toLowerCase();return e[PREVIOUS]=h(t),r=>{r=isVDom(r)&&"host"===r.tag?r.clone(t):h(t,{},r),diff(e,e,e,r)}}function diff(e,t,r,n,s,o){let i=r&&r[PREVIOUS]||new VDom,l=r;if(n&&"function"==typeof n.tag&&(n=n.tag(Object.assign({},n.props,{children:n.children}))),n instanceof VDom||(n=new VDom("",{},n)),i.tag!==n.tag)if(l=create(n.tag,s),r){if(""!==n.tag){let e=n.children.length;for(;r.firstChild&&e--;)append(l,r.firstChild)}replace(t,l,r)}else append(t,l);if(n.tag)if(diffProps(l,i.tag===n.tag?i.props:{},n.props,s),"slot"===n.tag){n.props.name}else{let t=o?l:l.shadowRoot||l,r=t.childNodes,i=n.children,a=0,c=Math.max(i.length,r.length);for(let n=0;n<c;n++){let l=n-a;n in i?diff(e,t,r[l],i[n],s,o+1):(remove(t,r[l]),a++)}}else i.children!==n.children&&(l.textContent=n.children);return l[PREVIOUS]=n,l}function diffProps(e,t,r,n){let s=Object.keys(t),o=Object.keys(r),i=s.concat(o),l={};for(let s=0;s<i.length;s++){let o=i[s];if(l[o]||t[o]===r[o])continue;l[o]=!0;let a="function"==typeof t[o],c="function"==typeof r[o];if(a||c)!c&&a&&e.removeEventListener(o,e[LISTENERS][o][0]),c&&(a||(e[LISTENERS]=e[LISTENERS]||{},e[LISTENERS][o]||(e[LISTENERS][o]=[t=>{e[LISTENERS][o][1](t)}]),e.addEventListener(o,e[LISTENERS][o][0])),e[LISTENERS][o][1]=r[o]);else if(o in r)if(o in e&&!n||n&&"style"===o)if("style"===o)if("object"==typeof r[o]){let n=t[o]||{},s=r[o];for(let t in s)n[t]!==s[t]&&("-"===t[0]?e.style.setProperty(t,s[t]):e.style[t]=s[t])}else e.style.cssText=r[o];else e[o]=r[o];else n?e.setAttributeNS(null,o,r[o]):e.setAttribute(o,r[o]);else e.removeAttribute(o)}}function camelCase(e){return e.replace(/-+([\w])/g,(e,t)=>t.toUpperCase())}function unCamelCase(e){return e.replace(/([^\-])([A-Z]+)/,(e,t,r)=>t+"-"+r.toLowerCase())}function getProps(e){let t=Array.isArray(e),r=[],n={};for(let s in e){let o=unCamelCase(t?e[s]:s);t?r.push(o):(r.push(o),n[o]=e[s],n[camelCase(s)]=e[s])}return{keys:r,types:n}}class Element extends HTMLElement{constructor(){super();let e,t=createRender(this);this.props={},this.countRender=0,this.preventRender=!0,this.proxy=getProps(this.constructor.props),this.load=(()=>{this.preventRender=!1,e()}),this.await=new Promise(t=>e=t),this.rerender=(e=>{this.preventRender||(this.preventRender=!0,Promise.resolve().then(()=>{t(this.render()),this.preventRender=!1,this.countRender++?this.onUpdated():this.onMounted()}))}),this.proxy.keys.forEach(e=>{e=camelCase(e),Object.defineProperty(this,e,{set(t){this.setProps({[e]:t})},get(){return this.props[e]}})})}static get props(){return[]}render(){}onMounted(){}onUpdated(){}onUnmounted(){}setProps(e){let t,r={};for(let n in e){let s=this.props[n];if(e[n]!==s){let o=this.proxy.types[n],i=o?o(e[n],s):e[n];i!==s&&(r[n]=i,t=!0)}}t&&(this.props=Object.assign({},this.props,r),this.rerender())}setAttribute(e,t){this.proxy.keys.indexOf(e)>-1?this.setProps({[camelCase(e)]:t}):super.setAttribute(e,t)}static get observedAttributes(){return getProps(this.props).keys}connectedCallback(){this.load(),this.await.then(()=>this.rerender())}disconnectedCallback(){this.await.then(()=>this.onUnmounted())}attributeChangedCallback(e,t,r){this.setProps({[e]:r})}}exports.Element=Element,exports.h=h,exports.createRender=createRender;
//# sourceMappingURL=atomico.js.map
