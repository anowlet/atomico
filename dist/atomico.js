"use strict";function remove(e,t){e.removeChild(t)}function append(e,t){e.appendChild(t)}function replace(e,t,r){e.replaceChild(t,r)}function create(e,t){return t?document.createElementNS("http://www.w3.org/2000/svg",e):e?document.createElement(e):document.createTextNode("")}function h(e,t,...r){return new VDom(e,t,concat(r))}Object.defineProperty(exports,"__esModule",{value:!0});class VDom{constructor(e,t,r){this.tag=e,this.props=t||{},this.children=r||[]}clone(e=this.tag,t=this.props,r=this.children){return new VDom(e,Object.assign({},t),r)}}function isVDom(e){return e instanceof VDom}function concat(e,t=[]){for(let r=0;r<e.length;r++){let n=e[r];Array.isArray(n)?concat(n,t):t.push(n)}return t}let PREVIOUS="__PREVIOUS__",LISTENERS="__LISTENERS__";function createRender(e){let t=e.tagName.toLowerCase();return e[PREVIOUS]=h(t),r=>{r=isVDom(r)&&"host"===r.tag?r.clone(t):h(t,{},r),diff(e,e,e,r)}}function diff(e,t,r,n,s,o){let i=r&&r[PREVIOUS]||new VDom,c=r;if(n&&"function"==typeof n.tag&&(n=n.tag(Object.assign({},n.props,{children:n.children}))),n instanceof VDom||(n=new VDom("",{},n)),i.tag!==n.tag)if(c=create(n.tag,s),r){if(""!==n.tag){let e=n.children.length;for(;r.firstChild&&e--;)append(c,r.firstChild)}replace(t,c,r)}else append(t,c);if(n.tag)if(diffProps(c,i.tag===n.tag?i.props:{},n.props,s),"slot"===n.tag){n.props.name}else{let t=o?c:c.shadowRoot||c,r=t.childNodes,i=n.children,l=0,a=Math.max(i.length,r.length);for(let n=0;n<a;n++){let c=n-l;n in i?diff(e,t,r[c],i[n],s,o+1):(remove(t,r[c]),l++)}}else i.children!==n.children&&(c.textContent=n.children);return c[PREVIOUS]=n,c}function diffProps(e,t,r,n){let s=Object.keys(t),o=Object.keys(r),i=s.concat(o),c={};for(let s=0;s<i.length;s++){let o=i[s];if(c[o]||t[o]===r[o])continue;c[o]=!0;let l="function"==typeof t[o],a="function"==typeof r[o];if(l||a)!a&&l&&e.removeEventListener(o,e[LISTENERS][o][0]),a&&(l||(e[LISTENERS]=e[LISTENERS]||{},e[LISTENERS][o]||(e[LISTENERS][o]=[t=>{e[LISTENERS][o][1](t)}]),e.addEventListener(o,e[LISTENERS][o][0])),e[LISTENERS][o][1]=r[o]);else if(o in r)if(o in e&&!n||n&&"style"===o)if("style"===o)if("object"==typeof r[o]){let n=t[o]||{},s=r[o];for(let t in s)n[t]!==s[t]&&("-"===t[0]?e.style.setProperty(t,s[t]):e.style[t]=s[t])}else e.style.cssText=r[o];else e[o]=r[o];else n?e.setAttributeNS(null,o,r[o]):e.setAttribute(o,r[o]);else e.removeAttribute(o)}}function camelCase(e){return e.replace(/-+([\w])/g,(e,t)=>t.toUpperCase())}function unCamelCase(e){return e.replace(/([^\-])([A-Z]+)/,(e,t,r)=>t+"-"+r.toLowerCase())}function getProps(e){let t=Array.isArray(e),r=[],n={};for(let s in e){let o=unCamelCase(t?e[s]:s);t?r.push(o):(r.push(o),n[o]=e[s],n[camelCase(s)]=e[s])}return{keys:r,types:n}}class Element extends HTMLElement{constructor(){super();let e=createRender(this);this.props={},this.isMount=!1,this.countRender=0,this.preventRender=!1,this.proxy=getProps(this.constructor.props),this.rerender=(t=>{this.isMount&&(this.preventRender||(this.preventRender=!0,Promise.resolve().then(()=>{e(this.render()),this.preventRender=!1,this.countRender++?this.onUpdated():this.onMounted()})))}),this.proxy.keys.forEach(e=>{e=camelCase(e),Object.defineProperty(this,e,{set(t){this.setProps({[e]:t})},get(){return this.props[e]}})})}static get props(){return[]}render(){}onMounted(){}onUpdated(){}onUnmounted(){}setProps(e){let t,r={};for(let n in e){let s=this.props[n];if(e[n]!==s){let o=this.proxy.types[n],i=o?o(e[n],s):e[n];i!==s&&(r[n]=i,t=!0)}}t&&(this.props=Object.assign({},this.props,r),this.rerender())}setAttribute(e,t){this.proxy.keys.indexOf(e)>-1?this.setProps({[camelCase(e)]:t}):super.setAttribute(e,t)}static get observedAttributes(){return getProps(this.props).keys}connectedCallback(){this.isMount=!0,this.rerender()}disconnectedCallback(){this.isMount&&this.onUnmounted()}attributeChangedCallback(e,t,r){this.setProps({[e]:r})}}exports.Element=Element,exports.h=h,exports.createRender=createRender;
//# sourceMappingURL=atomico.js.map
