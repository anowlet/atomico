function remove(e,t){e.removeChild(t)}function append(e,t){e.appendChild(t)}function replace(e,t,r){e.replaceChild(t,r)}function create(e,t){return t?document.createElementNS("http://www.w3.org/2000/svg",e):e?document.createElement(e):document.createTextNode("")}function h(e,t,...r){return new VDom(e,t,concat(r))}class VDom{constructor(e,t,r){this.tag=e,this.props=t||{},this.children=r||[]}clone(e=this.tag,t=this.props,r=this.children){return new VDom(e,Object.assign({},t),r)}}function isVDom(e){return e instanceof VDom}function concat(e,t=[]){for(let r=0;r<e.length;r++){let n=e[r];Array.isArray(n)?concat(n,t):t.push(n)}return t}let PREVIOUS="__PREVIOUS__",LISTENERS="__LISTENERS__";function createRender(e){let t=e.tagName.toLowerCase();return e[PREVIOUS]=h(t),r=>{r=isVDom(r)&&"host"===r.tag?r.clone(t):h(t,{},r),diff(e,e,e,r)}}function diff(e,t,r,n,s,i){let o=r&&r[PREVIOUS]||new VDom,a=r;if(n&&"function"==typeof n.tag&&(n=n.tag(Object.assign({},n.props,{children:n.children}))),n instanceof VDom||(n=new VDom("",{},n)),o.tag!==n.tag)if(a=create(n.tag,s),r){if(""!==n.tag){let e=n.children.length;for(;r.firstChild&&e--;)append(a,r.firstChild)}replace(t,a,r)}else append(t,a);if(n.tag)if(diffProps(a,o.tag===n.tag?o.props:{},n.props,s),"slot"===n.tag){n.props.name}else{let t=i?a:a.shadowRoot||a,r=t.childNodes,o=n.children,l=0,c=Math.max(o.length,r.length);for(let n=0;n<c;n++){let a=n-l;n in o?diff(e,t,r[a],o[n],s,i+1):(remove(t,r[a]),l++)}}else o.children!==n.children&&(a.textContent=n.children);return a[PREVIOUS]=n,a}function diffProps(e,t,r,n){let s=Object.keys(t),i=Object.keys(r),o=s.concat(i),a={};for(let s=0;s<o.length;s++){let i=o[s];if(a[i]||t[i]===r[i])continue;a[i]=!0;let l="function"==typeof t[i],c="function"==typeof r[i];if(l||c)!c&&l&&e.removeEventListener(i,e[LISTENERS][i][0]),c&&(l||(e[LISTENERS]=e[LISTENERS]||{},e[LISTENERS][i]||(e[LISTENERS][i]=[t=>{e[LISTENERS][i][1](t)}]),e.addEventListener(i,e[LISTENERS][i][0])),e[LISTENERS][i][1]=r[i]);else if(i in r)if(i in e&&!n||n&&"style"===i)if("style"===i)if("object"==typeof r[i]){let n=t[i]||{},s=r[i];for(let t in s)n[t]!==s[t]&&("-"===t[0]?e.style.setProperty(t,s[t]):e.style[t]=s[t])}else e.style.cssText=r[i];else e[i]=r[i];else n?e.setAttributeNS(null,i,r[i]):e.setAttribute(i,r[i]);else e.removeAttribute(i)}}function camelCase(e){return e.replace(/-+([\w])/g,(e,t)=>t.toUpperCase())}function unCamelCase(e){return e.replace(/([^\-])([A-Z]+)/,(e,t,r)=>t+"-"+r.toLowerCase())}function getProps(e){let t=Array.isArray(e),r=[],n={};for(let s in e){let i=unCamelCase(t?e[s]:s);t?r.push(i):(r.push(i),n[i]=e[s],n[camelCase(s)]=e[s])}return{keys:r,types:n}}class Element extends HTMLElement{constructor(){super();let e,t=createRender(this);this.props={},this.countRender=0,this.preventRender=!0,this.proxy=getProps(this.constructor.props),this.load=(()=>{this.preventRender=!1,e()}),this.await=new Promise(t=>e=t),this.rerender=(e=>{this.preventRender||(this.preventRender=!0,Promise.resolve().then(()=>{t(this.render()),this.preventRender=!1,this.countRender++?this.onUpdated():this.onMounted()}))}),this.proxy.keys.forEach(e=>{e=camelCase(e),Object.defineProperty(this,e,{set(t){this.setProps({[e]:t})},get(){return this.props[e]}})})}static get props(){return[]}render(){}onMounted(){}onUpdated(){}onUnmounted(){}setProps(e){let t,r={};for(let n in e){let s=this.props[n];if(e[n]!==s){let i=this.proxy.types[n],o=i?i(e[n],s):e[n];o!==s&&(r[n]=o,t=!0)}}t&&(this.props=Object.assign({},this.props,r),this.rerender())}setAttribute(e,t){this.proxy.keys.indexOf(e)>-1?this.setProps({[camelCase(e)]:t}):super.setAttribute(e,t)}static get observedAttributes(){return getProps(this.props).keys}connectedCallback(){this.load(),this.await.then(()=>this.rerender())}disconnectedCallback(){this.await.then(()=>this.onUnmounted())}attributeChangedCallback(e,t,r){this.setProps({[e]:r})}}export{Element,h,createRender};
//# sourceMappingURL=atomico.m.js.map
